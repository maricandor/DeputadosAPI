<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscrever</title>
    <link rel="stylesheet" href="../css/inscrever.css">
    <script src="../js/script.js"></script>
</head>

<body>

    <h1>Inscrever-se</h1>

    <form id="formInscrever">
        <label for="idDeputado">ID Deputado:</label><br><br>
        <input type="text" id="idDeputado" name="idDeputado"><br><br>
    </form>

    <select id="eventosDropdown" onchange="carregarDetalhesEvento(this.value)">
    </select><br><br>

    <button type="button" onclick="inscreverEvento()">Inscrever-se</button><br><br>

    <div id="detalhesEvento">
    </div>


    <button onclick="window.location.href='eventsList.html'">Voltar</button>

    <script>
        async function carregarEventosDropdown() {
            try {
                const response = await fetch('http://localhost:8080/eventos', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });
                const data = await response.json();

                console.log('Dados recebidos:', data);

                const dropdown = document.getElementById('eventosDropdown');
                dropdown.innerHTML = '';

                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'Selecione um evento';
                dropdown.appendChild(defaultOption);

                data.forEach(evento => {
                    const option = document.createElement('option');
                    option.value = evento.id;
                    option.textContent = evento.descricaoTipo;
                    dropdown.appendChild(option);
                });

                dropdown.onchange = function () {
                    const selectedEventoId = dropdown.value;
                    carregarDetalhesEvento(selectedEventoId);
                };
            } catch (error) {
                console.error('Erro ao carregar eventos:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', carregarEventosDropdown);

        async function carregarDetalhesEvento(eventoId) {
            if (!eventoId) {
                return;
            }

            try {
                const response = await fetch(`http://localhost:8080/eventos/${eventoId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });
                const detalhesEvento = await response.json();

                const detalhesEventoDiv = document.getElementById('detalhesEvento');
                detalhesEventoDiv.innerHTML = `<p>Detalhes do Evento:</p>
                                <p>Descrição: ${detalhesEvento.descricao}</p>`;
            } catch (error) {
                console.error('Erro ao carregar detalhes do evento:', error);
            }
        }


        async function inscreverEvento() {
    const idDeputado = document.getElementById('idDeputado').value;
    const idEventoSelect = document.getElementById('eventosDropdown');
    const idEvento = idEventoSelect.value;

    try {
        const response = await fetch('http://localhost:8080/deputados/vincular', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                idEvento: idEvento,
                idDeputado: idDeputado
            }),
        });
        const responseData = await response.json();
        console.log('Resposta do backend:', responseData);

        if (response.ok) {
            console.log('Sucesso:', responseData.mensagem);
        } else {
            console.log('Erro:', responseData);
        }

    } catch (error) {
        console.error('Erro ao vincular evento:', error);
    }
        }
    </script>

</body>

</html>